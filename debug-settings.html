<!DOCTYPE html>
<html>
<head>
    <title>Promptiply Debug Settings</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #e0e0e0;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        h2 {
            color: #7c3aed;
            margin-top: 0;
        }
        pre {
            background: #0a0a0a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        button {
            background: linear-gradient(135deg, #7c3aed, #06b6d4);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            filter: brightness(1.1);
        }
        input, select {
            background: #1a1a1a;
            color: #e0e0e0;
            border: 1px solid #444;
            padding: 8px;
            border-radius: 4px;
            width: 300px;
        }
        label {
            display: inline-block;
            width: 150px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Promptiply Debug & Fix Tool</h1>

    <div class="section">
        <h2>Current Settings</h2>
        <pre id="currentSettings">Loading...</pre>
    </div>

    <div class="section">
        <h2>Quick Fix Options</h2>

        <div>
            <h3>Option 1: Switch to WebUI Mode (No API Key Needed)</h3>
            <p>This will use ChatGPT/Claude web interface directly</p>
            <button id="switchToWebUI">Switch to WebUI Mode</button>
        </div>

        <div>
            <h3>Option 2: Configure OpenAI API Key</h3>
            <label>OpenAI API Key:</label>
            <input type="password" id="openaiKey" placeholder="sk-...">
            <button id="setOpenAIKey">Save API Key</button>
        </div>

        <div>
            <h3>Option 3: Switch to Local Mode (No API Key Needed)</h3>
            <p>Uses local LLM with WebGPU (requires model download)</p>
            <button id="switchToLocal">Switch to Local Mode</button>
        </div>
    </div>

    <div class="section">
        <h2>Advanced Settings</h2>
        <div>
            <label>Mode:</label>
            <select id="mode">
                <option value="api">API</option>
                <option value="webui">WebUI</option>
                <option value="local">Local</option>
            </select>
        </div>
        <div>
            <label>Provider:</label>
            <select id="provider">
                <option value="openai">OpenAI</option>
                <option value="anthropic">Anthropic</option>
            </select>
        </div>
        <button id="saveAdvanced">Save Advanced Settings</button>
    </div>

    <div class="section">
        <h2>Test Refinement</h2>
        <textarea id="testPrompt" placeholder="Enter a test prompt here..." style="width: 100%; height: 100px; background: #1a1a1a; color: #e0e0e0; border: 1px solid #444; padding: 10px; border-radius: 4px;"></textarea>
        <button id="testRefine">Test Refinement</button>
        <pre id="testResult"></pre>
    </div>

    <script>
        // Load current settings
        async function loadSettings() {
            const data = await chrome.storage.local.get(['settings']);
            const settings = data.settings || {};
            document.getElementById('currentSettings').textContent = JSON.stringify(settings, null, 2);

            // Populate form fields
            document.getElementById('mode').value = settings.mode || 'api';
            document.getElementById('provider').value = settings.provider || 'openai';
            document.getElementById('openaiKey').value = settings.openaiKey || '';

            return settings;
        }

        // Switch to WebUI mode
        document.getElementById('switchToWebUI').addEventListener('click', async () => {
            const data = await chrome.storage.local.get(['settings']);
            const settings = data.settings || {};
            settings.mode = 'webui';
            await chrome.storage.local.set({ settings });
            alert('✓ Switched to WebUI mode! Reload ChatGPT/Claude page and try again.');
            loadSettings();
        });

        // Set OpenAI API key
        document.getElementById('setOpenAIKey').addEventListener('click', async () => {
            const apiKey = document.getElementById('openaiKey').value.trim();
            if (!apiKey) {
                alert('Please enter an API key');
                return;
            }
            const data = await chrome.storage.local.get(['settings']);
            const settings = data.settings || {};
            settings.openaiKey = apiKey;
            settings.mode = 'api';
            settings.provider = 'openai';
            await chrome.storage.local.set({ settings });
            alert('✓ OpenAI API key saved! Try refining a prompt now.');
            loadSettings();
        });

        // Switch to Local mode
        document.getElementById('switchToLocal').addEventListener('click', async () => {
            const data = await chrome.storage.local.get(['settings']);
            const settings = data.settings || {};
            settings.mode = 'local';
            await chrome.storage.local.set({ settings });
            alert('✓ Switched to Local mode! First run will download the model. Reload ChatGPT/Claude page and try again.');
            loadSettings();
        });

        // Save advanced settings
        document.getElementById('saveAdvanced').addEventListener('click', async () => {
            const data = await chrome.storage.local.get(['settings']);
            const settings = data.settings || {};
            settings.mode = document.getElementById('mode').value;
            settings.provider = document.getElementById('provider').value;
            await chrome.storage.local.set({ settings });
            alert('✓ Settings saved!');
            loadSettings();
        });

        // Test refinement
        document.getElementById('testRefine').addEventListener('click', async () => {
            const testPrompt = document.getElementById('testPrompt').value.trim();
            if (!testPrompt) {
                alert('Please enter a test prompt');
                return;
            }

            document.getElementById('testResult').textContent = 'Testing refinement...';

            try {
                const response = await chrome.runtime.sendMessage({
                    type: 'PR_REFINEMENT_REQUEST',
                    payload: { prompt: testPrompt }
                });

                document.getElementById('testResult').textContent = JSON.stringify(response, null, 2);
            } catch (error) {
                document.getElementById('testResult').textContent = 'Error: ' + error.message;
            }
        });

        // Load settings on page load
        loadSettings();
    </script>
</body>
</html>
