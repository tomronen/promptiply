<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>promptiply Settings</title>
  <link rel="icon" type="image/png" href="../icons/icon-48.png" />
  <link rel="stylesheet" href="styles.css" />
  <!-- Options loader: tries index.js, falls back to index-fix.js on error -->
  <script defer src="index-loader.js"></script>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="title title-flex">
        <img src="../icons/icon-48.png" alt="promptiply" class="icon-48" />
        promptiply — Settings
      </div>
  <div class="header-controls">
        <div class="muted" id="version">-</div>
      </div>
    </div>
    <div class="tabs">
      <div class="tab active" data-tab="general">General</div>
      <div class="tab" data-tab="providers">Providers</div>
      <div class="tab" data-tab="profiles">Profiles</div>
    </div>

    <div class="panel" id="tab-general">
      <div class="grid">
        <div class="field field-no-margin">
          <label>Refinement Mode</label>
          <select id="mode">
            <option value="api">API (OpenAI/Anthropic)</option>
            <option value="webui">WebUI (use provider site)</option>
            <option value="local">Local (Llama 3 via web-llm)</option>
          </select>
        </div>
        <div class="field field-no-margin">
          <label>Provider</label>
          <select id="provider">
            <option value="openai">OpenAI (ChatGPT)</option>
            <option value="anthropic">Anthropic (Claude)</option>
          </select>
        </div>
      </div>
      <div class="field field-full field-top-margin">
        <label>Refine Hotkey</label>
        <div class="hotkey-row">
          <div id="refine-hotkey-display" class="hotkey-display">
            <span id="refine-hotkey-text">-</span>
          </div>
          <button id="refine-hotkey-record" type="button">Change</button>
        </div>
        <div id="refine-hotkey-recording" class="hotkey-hint">
          Press your desired key combination... (Press Escape to cancel)
        </div>
      </div>
      <div class="actions actions-top-margin">
        <button id="save-settings" class="primary">Save Settings</button>
        <button id="run-onboarding" class="secondary">Run Onboarding Wizard</button>
      </div>
    </div>

    <div class="panel tab-panel-hidden" id="tab-providers">
      <div class="grid">
        <div>
          <div class="field"><label>OpenAI API Key</label><input id="openai-key" type="password" placeholder="OpenAI API Key" /></div>
          <div class="field field-no-margin"><label>OpenAI Model</label>
            <select id="openai-model-select">
              <option value="gpt-5-nano">gpt-5-nano</option>
              <option value="gpt-5-mini">gpt-5-mini</option>
              <option value="gpt-5">gpt-5</option>
              <option value="custom">Custom…</option>
            </select>
            <input id="openai-model-custom" type="text" placeholder="Custom model id" class="custom-input-hidden" />
          </div>
        </div>
        <div>
          <div class="field"><label>Anthropic API Key</label><input id="anthropic-key" type="password" placeholder="Anthropic API Key" /></div>
          <div class="field field-no-margin"><label>Anthropic Model</label>
            <select id="anthropic-model-select">
              <option value="claude-haiku-4-5">Claude Haiku 4.5</option>
              <option value="claude-sonnet-4-5">Claude Sonnet 4.5</option>
              <option value="custom">Custom…</option>
            </select>
            <input id="anthropic-model-custom" type="text" placeholder="Custom model id" class="custom-input-hidden" />
          </div>
        </div>
      </div>
      <div class="actions actions-top-margin">
        <button id="save-providers-settings" class="primary">Save Settings</button>
      </div>
    </div>

    <div class="panel tab-panel-hidden" id="tab-profiles">
      <div class="actions actions-flex-end">
        <button id="new-profile" class="primary">New Profile</button>
      </div>
  <div class="predefined-section predefined-section--spaced">
        <div class="predefined-header">
          <div class="predefined-title">Predefined profiles</div>
          <div class="predefined-controls">
            <button id="import-all-predefined">Import</button>
            <button id="manage-predefined">Manage</button>
            <button id="export-predefined">Export</button>
            <button id="restore-predefined">Restore defaults</button>
          </div>
        </div>
      
        <div class="predefined-import-row">
          <label class="predefined-import-label">Import JSON file:</label>
          <input id="predefined-file" type="file" accept="application/json" class="hidden" />
          <button id="predefined-file-choose">Choose File</button>
          <span id="predefined-file-name" class="predefined-file-name">No file chosen</span>
          <label class="predefined-import-label predefined-import-label--url">Or load from URL:</label>
          <input id="predefined-url" type="text" placeholder="https://example.com/profiles.json" class="predefined-url-input" />
          <button id="predefined-url-load">Load</button>
          <button id="predefined-paste-json" title="Paste JSON">Paste JSON</button>
          <span id="predefined-url-spinner" hidden class="predefined-spinner" role="status" aria-live="polite"><span class="spinner-inline" aria-hidden="true"></span></span>
        </div>
        <div id="predefined-list" class="list"></div>
      </div>
      <div id="profiles-list" class="list"></div>
    </div>
    <!-- Export selection modal (top-level) -->
        <div class="modal" id="predefined-export-modal">
      <div class="dialog">
        <h3>Export profiles</h3>
        <div id="predefined-export-list" class="predefined-export-list"></div>
        <div class="dialog-actions">
          <button id="predefined-export-all" class="secondary">Export All</button>
          <button id="predefined-export-cancel">Cancel</button>
          <button id="predefined-export-confirm" class="primary">Export selected</button>
        </div>
      </div>
    </div>
  <!-- Import selection modal (top-level) -->
  <div class="modal" id="predefined-import-modal">
    <div class="dialog">
      <h3>Import predefined profiles</h3>
  <div class="predefined-import-top">
        <label><input type="radio" name="import-mode" value="replace"/> Replace current predefined list</label>
        <label><input type="radio" name="import-mode" value="merge" checked/> Merge selected into current list</label>
  <label class="predefined-import-selectall"><input type="checkbox" id="predefined-import-selectall"/> Select all</label>
      </div>
  <div id="predefined-import-list" class="predefined-import-list"></div>
  <div class="dialog-actions">
        <button id="predefined-import-cancel">Cancel</button>
        <button id="predefined-import-confirm" class="primary">Import selected</button>
      </div>
    </div>
  </div>
  
  <!-- Paste JSON modal (replaces prompt-based paste) -->
  <div class="modal" id="predefined-paste-modal">
    <div class="dialog">
      <h3>Paste predefined profiles JSON</h3>
      <p class="muted">Paste the JSON content exported from promptiply. The importer will validate the structure before showing import options.</p>
  <div class="predefined-paste-area">
  <textarea id="predefined-paste-textarea" placeholder="Paste JSON here" class="predefined-paste-textarea"></textarea>
  <div id="predefined-paste-error" class="predefined-paste-error"></div>
      </div>
  <div class="dialog-actions">
        <button id="predefined-paste-cancel">Cancel</button>
        <button id="predefined-paste-load" class="primary">Load and validate</button>
      </div>
    </div>
  </div>
    
    <!-- Predefined manage modal -->
    <div class="modal" id="predefined-modal">
      <div class="dialog">
        <h3>Manage predefined profiles</h3>
  <div id="predefined-manage-list" class="predefined-manage-list"></div>
  <div class="dialog-actions">
          <button id="predefined-manage-cancel">Cancel</button>
          <button id="predefined-manage-delete-selected">Delete selected</button>
          <button id="predefined-manage-save" class="primary">Save</button>
        </div>
      </div>
    </div>

    <!-- Restore confirmation modal -->
    <div class="modal" id="restore-modal">
      <div class="dialog">
        <h3>Restore predefined defaults</h3>
        <p class="muted">Restoring defaults will replace the built-in predefined profile list. You can also choose to remove any profiles you previously imported from the predefined list. This will not affect profiles you created manually unless you choose to delete them below.</p>
  <div class="restore-options-row">
          <input id="restore-delete-imported" type="checkbox" />
          <label for="restore-delete-imported">Also delete profiles imported from predefined list</label>
        </div>
  <div id="restore-preview" class="restore-preview"></div>
  <div class="dialog-actions">
          <button id="restore-cancel">Cancel</button>
          <button id="restore-confirm" class="primary">Restore Defaults</button>
        </div>
      </div>
    </div>

    <!-- Toast container for in-UI notifications -->
  <div id="toast-container" role="status" aria-live="polite" class="toast-root"></div>

    <p class="muted muted-top-margin">Your API keys are stored locally on this device. Profiles sync across Chrome if enabled.</p>
    
    <!-- Profile Wizard Modal (used by New Profile / Create Profile) -->
    <div class="modal" id="profile-modal">
      <div class="dialog">
        <div class="title-flex">
          <img src="../icons/icon-48.png" alt="promptiply" class="icon-48" />
          <div class="profile-wizard-title">Profile Wizard</div>
        </div>
        <div class="progress-wrap"><div class="wizard-progress" id="wizard-progress"></div></div>
        <div class="steps">
          <div class="step" data-step="1">Basics</div>
          <div class="step" data-step="2">Guidelines</div>
          <div class="step" data-step="3">Review</div>
        </div>
        <div id="wizard-body"></div>
        <div class="actions actions-space-between actions-top-margin">
          <div>
            <button id="wizard-cancel">Cancel</button>
          </div>
          <div>
            <button id="wizard-back">Back</button>
            <button id="wizard-next" class="primary">Next</button>
            <button id="wizard-save" class="primary wizard-save-hidden">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Onboarding Wizard Modal (rich) -->
    <div class="modal" id="onboarding-modal">
      <div class="dialog onboarding-dialog">
        <div class="onboarding-header">
          <img src="../icons/icon-48.png" alt="promptiply" class="icon-48" />
          <h2>Welcome to promptiply!</h2>
        </div>
        <div class="steps">
          <div class="step" data-step="1">Modes</div>
          <div class="step" data-step="2">Setup</div>
          <div class="step" data-step="3">Profile</div>
          <div class="step" data-step="4">Ready</div>
        </div>
        <div id="onboarding-body"></div>
        <div class="actions actions-space-between actions-top-margin">
          <div>
            <button id="onboarding-skip">Skip</button>
          </div>
          <div>
            <button id="onboarding-back">Back</button>
            <button id="onboarding-next" class="primary">Next</button>
            <button id="onboarding-finish" class="primary wizard-save-hidden">Get Started</button>
          </div>
        </div>
      </div>
    </div>
</body>
</html>




